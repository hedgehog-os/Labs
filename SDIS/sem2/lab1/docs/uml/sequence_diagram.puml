@startuml sequence_diagram
' Police Management System - Crime Investigation Sequence Diagram
' UML 2.5

skinparam defaultFontName "Arial"
skinparam fontSize 10
skinparam sequence {
    LifeLineBackgroundColor White
    LifeLineBorderColor Black
    ArrowColor Black
}
skinparam roundcorner 5
skinparam maxmessages 50

title Crime Investigation Process (investigate --arrest)

actor "User" as U
participant "CLI" as C
participant "PoliceSystem" as S
participant "Investigation" as I
participant "Police" as P
participant "Policeman" as O

== Initialization ==

U -> C : investigate --arrest
C -> S : investigate_crimes(do_arrest=True)

== Clear Stale Assignments ==

S -> P : get_policemen()
activate P
P --> S : list[Policeman]
deactivate P

loop For each officer
    S -> O : clear_assignment()
    activate O
    O --> S : _criminal = None
    deactivate O
end

== Investigation Phase ==

S -> I : investigate_all()
activate I

loop For each crime
    I -> I : Check guilt\n(severity / 5.0)
    I --> S : (crime, severity)
end

deactivate I

== Assignment Phase ==

S -> P : get_policemen()
activate P
P --> S : list[Policeman]
deactivate P

loop For each result
    S -> S : Filter available\n(not resting, no assignment)
    
    alt Officer available
        S -> O : assign_crime((crime, severity))
        activate O
        O --> S : _criminal assigned
        deactivate O
    else No available officer
        S --> S : âš  No available officer
    end
end

== Arrest Phase ==

S -> P : get_policemen()
activate P
P --> S : list[Policeman]
deactivate P

loop For each officer with assignment
    S -> O : arrest()
    activate O
    O -> O : Check success\n(fatigue, severity)
    
    alt Success
        O --> S : True
        O -> O : _criminal = None
        note right: Crime will be removed
    else Failure
        O --> S : False
        note right: Suspect remains
    end
    
    O -> O : fatigue++
    O -> O : check_exhaustion()\nif fatigue >= 6: is_resting = True
    
    deactivate O
end

== Cleanup Phase ==

loop For each arrested suspect
    S -> S : Remove crime from\napplications
end

== Security Update ==

S -> S : _update_security()\n(citizens per zone / crimes per zone)
S --> C : Display results
C --> U : Output

note right
    Security formula:
    zone_security = citizens_in_zone / crimes_in_zone
    
    If no crimes: 10.0
    If no citizens: 0.0
end note

@enduml
